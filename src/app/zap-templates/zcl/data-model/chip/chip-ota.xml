<?xml version="1.0"?>
<configurator>
  <cluster>
    <client init="false" tick="false">true</client>
    <code>0x0029</code>
    <command cli="chip ota queryimage" code="0x00" name="QueryImage" optional="false" response="QueryImageResponse" source="client">
      <arg name="VendorID" type="vendor_id"/>
      <arg name="ProductID" type="int16u"/>
      <arg name="SoftwareVersion" type="int32u"/>
      <arg array="true" name="ProtocolsSupported" type="DownloadProtocolEnum"/>
      <arg name="HardwareVersion" optional="true" type="int16u"/>
      <arg length="2" name="Location" optional="true" type="char_string"/>
      <arg default="false" name="RequestorCanConsent" optional="true" type="boolean"/>
      <arg length="512" name="MetadataForProvider" optional="true" type="octet_string"/>
      <description>Determine availability of a new Software Image</description>
    </command>
    <command cli="chip ota queryimageresponse" code="0x01" name="QueryImageResponse" optional="false" source="server">
      <arg name="Status" type="StatusEnum"/>
      <arg name="DelayedActionTime" optional="true" type="int32u"/>
      <arg length="256" name="ImageURI" optional="true" type="char_string"/>
      <arg name="SoftwareVersion" optional="true" type="int32u"/>
      <arg length="64" name="SoftwareVersionString" optional="true" type="char_string"/>
      <arg length="32" name="UpdateToken" optional="true" type="octet_string"/>
      <arg default="false" name="UserConsentNeeded" optional="true" type="boolean"/>
      <arg length="512" name="MetadataForRequestor" optional="true" type="octet_string"/>
      <description>Response to QueryImage command</description>
    </command>
    <command cli="chip ota applyupdaterequest" code="0x02" name="ApplyUpdateRequest" optional="false" response="ApplyUpdateResponse" source="client">
      <arg length="32" name="UpdateToken" type="octet_string"/>
      <arg name="NewVersion" type="int32u"/>
      <description>Determine next action to take for a downloaded Software Image</description>
    </command>
    <command cli="chip ota applyupdateresponse" code="0x03" name="ApplyUpdateResponse" optional="false" source="server">
      <arg name="Action" type="ApplyUpdateActionEnum"/>
      <arg name="DelayedActionTime" type="int32u"/>
      <description>Reponse to ApplyUpdateRequest command</description>
    </command>
    <command cli="chip ota notifyupdateapplied" code="0x04" name="NotifyUpdateApplied" optional="false" source="client">
      <arg length="32" name="UpdateToken" type="octet_string"/>
      <arg name="SoftwareVersion" type="int32u"/>
      <description>Notify OTA Provider that an update was applied</description>
    </command>
    <define>OTA_SOFTWARE_UPDATE_PROVIDER_CLUSTER</define>
    <description>Provides an interface for providing OTA software updates</description>
    <domain>CHIP</domain>
    <name>OTA Software Update Provider</name>
    <server init="false" tick="false">true</server>
  </cluster>
  <cluster>
    <attribute code="0x0000" define="DEFAULT_OTA_PROVIDERS" entryType="ProviderLocation" optional="false" side="server" type="ARRAY" writable="true">DefaultOTAProviders</attribute>
    <attribute code="0x0001" default="true" define="UPDATE_POSSIBLE" optional="false" side="server" type="boolean" writable="false">UpdatePossible</attribute>
    <attribute code="0x0002" default="Unknown" define="UPDATE_STATE" optional="false" side="server" type="UpdateStateEnum" writable="false">UpdateState</attribute>
    <attribute code="0x0003" define="UPDATE_STATE_PROGRESS" isNullable="true" max="100" min="0" optional="false" side="server" type="int8u" writable="false">UpdateStateProgress</attribute>
    <client init="false" tick="false">true</client>
    <code>0x002a</code>
    <command cli="chip ota announceotaprovider" code="0x00" name="AnnounceOTAProvider" optional="true" source="client">
      <arg name="ProviderNodeID" type="node_id"/>
      <arg name="VendorID" type="vendor_id"/>
      <arg name="AnnouncementReason" type="AnnouncementReasonEnum"/>
      <arg length="512" name="MetadataForNode" optional="true" type="octet_string"/>
      <arg name="Endpoint" type="endpoint_no"/>
      <description>Announce the presence of an OTA Provider</description>
    </command>
    <define>OTA_SOFTWARE_UPDATE_REQUESTOR_CLUSTER</define>
    <description>Provides an interface for downloading and applying OTA software updates</description>
    <domain>CHIP</domain>
    <event code="0x00" name="StateTransition" optional="false" priority="info" side="server">
      <description>This event SHALL be generated when a change of the UpdateState attribute occurs due to an OTA Requestor moving through the states necessary to query for updates.</description>
      <field id="0" name="PreviousState" type="UpdateStateEnum"/>
      <field id="1" name="NewState" type="UpdateStateEnum"/>
      <field id="2" name="Reason" type="ChangeReasonEnum"/>
      <field id="3" isNullable="true" name="TargetSoftwareVersion" type="int32u"/>
    </event>
    <event code="0x01" name="VersionApplied" optional="false" priority="critical" side="server">
      <description>This event SHALL be generated whenever a new version starts executing after being applied due to a software update.</description>
      <field id="0" name="SoftwareVersion" type="int32u"/>
      <field id="1" name="ProductID" type="int16u"/>
    </event>
    <event code="0x02" name="DownloadError" optional="false" priority="info" side="server">
      <description>This event SHALL be generated whenever an error occurs during OTA Requestor download operation.</description>
      <field id="0" name="SoftwareVersion" type="int32u"/>
      <field id="1" name="BytesDownloaded" type="int64u"/>
      <field id="2" isNullable="true" max="100" min="0" name="ProgressPercent" type="int8u"/>
      <field id="3" isNullable="true" name="PlatformCode" type="int64s"/>
    </event>
    <name>OTA Software Update Requestor</name>
    <server init="false" tick="false">true</server>
  </cluster>
  <domain certifiable="true" dependsOn="zcl-1.0-07-5123-03" name="CHIP" spec="chip-0.7"/>
  <enum name="StatusEnum" type="enum8">
    <cluster code="0x0029"/>
    <item name="UpdateAvailable" value="0x0"/>
    <item name="Busy" value="0x1"/>
    <item name="NotAvailable" value="0x2"/>
    <item name="DownloadProtocolNotSupported" value="0x3"/>
  </enum>
  <enum name="ApplyUpdateActionEnum" type="enum8">
    <cluster code="0x0029"/>
    <item name="Proceed" value="0x0"/>
    <item name="AwaitNextAction" value="0x1"/>
    <item name="Discontinue" value="0x2"/>
  </enum>
  <enum name="DownloadProtocolEnum" type="enum8">
    <cluster code="0x0029"/>
    <item name="BDXSynchronous" value="0x0"/>
    <item name="BDXAsynchronous" value="0x1"/>
    <item name="HTTPS" value="0x2"/>
    <item name="VendorSpecific" value="0x3"/>
  </enum>
  <enum name="AnnouncementReasonEnum" type="enum8">
    <cluster code="0x002a"/>
    <item name="SimpleAnnouncement" value="0x0"/>
    <item name="UpdateAvailable" value="0x1"/>
    <item name="UrgentUpdateAvailable" value="0x2"/>
  </enum>
  <enum name="UpdateStateEnum" type="enum8">
    <cluster code="0x002a"/>
    <item name="Unknown" value="0x0"/>
    <item name="Idle" value="0x1"/>
    <item name="Querying" value="0x2"/>
    <item name="DelayedOnQuery" value="0x3"/>
    <item name="Downloading" value="0x4"/>
    <item name="Applying" value="0x5"/>
    <item name="DelayedOnApply" value="0x6"/>
    <item name="RollingBack" value="0x7"/>
    <item name="DelayedOnUserConsent" value="0x8"/>
  </enum>
  <enum name="ChangeReasonEnum" type="enum8">
    <cluster code="0x002a"/>
    <item name="Unknown" value="0x0"/>
    <item name="Success" value="0x1"/>
    <item name="Failure" value="0x2"/>
    <item name="TimeOut" value="0x3"/>
    <item name="DelayByProvider" value="0x4"/>
  </enum>
  <struct isFabricScoped="true" name="ProviderLocation">
    <cluster code="0x002a"/>
    <item fieldId="1" name="ProviderNodeID" type="node_id"/>
    <item fieldId="2" name="Endpoint" type="endpoint_no"/>
  </struct>
</configurator>
